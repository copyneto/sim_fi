sap.ui.define([                                                                                                                                                                                                                                                
    "sap/m/MessageToast"                                                                                                                                                                                                                                       
], function (MessageToast) {                                                                                                                                                                                                                                   
    'use strict';                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return {                                                                                                                                                                                                                                                   
        ShowPDF: function (oEvent) {                                                                                                                                                                                                                           
                        /* ===================================================================&nbsp;                                                                                                                                                           
                Recupera a linha selecionada&nbsp;                                                                                                                                                                                                             
            =================================================================== */                                                                                                                                                                             
            var oSelection = this.extensionAPI.getSelectedContexts();                                                                                                                                                                                          
            var vChave = '';                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            if (oSelection.length > 1) {                                                                                                                                                                                                                       
                alert('Selecionar apenas uma linha para a geração de boleto');                                                                                                                                                                                 
                return;                                                                                                                                                                                                                                        
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            if (oSelection.length > 0) {                                                                                                                                                                                                                       
                vChave = oSelection.reduce(function (sText, oSelectedContext) {                                                                                                                                                                                
                    var mSelectedData = oSelectedContext.getObject();                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (mSelectedData.NossoNumero == '') {                                                                                                                                                                                                     
                        return;                                                                                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    return sText +                                                                                                                                                                                                                             
                        "empresa='" + mSelectedData.Empresa + "'," +                                                                                                                                                                                           
                        "documento='" + mSelectedData.Documento + "'," +                                                                                                                                                                                       
                        "exercicio='" + mSelectedData.Exercicio + "'," +                                                                                                                                                                                       
                        "parcela='" + mSelectedData.Parcela + "'";                                                                                                                                                                                             
                }, "");                                                                                                                                                                                                                                        
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            if (!vChave) {                                                                                                                                                                                                                                     
                alert('Boleto não disponível');                                                                                                                                                                                                                
                return;                                                                                                                                                                                                                                        
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Chama serviço gateway (SEGW)&nbsp;                                                                                                                                                                                                                 
            =================================================================== */                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            var vServiceURL = "/sap/opu/odata/SAP/ZFI_BOLETO_SRV_SRV/";                                                                                                                                                                                        
            var oModel = new sap.ui.model.odata.ODataModel(vServiceURL, false);                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            var vServiceUrlRead = "pdfSet(" + vChave + ")/$value";                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            oModel.read(vServiceUrlRead, null, null, true,                                                                                                                                                                                                     
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Em caso de sucesso, Chama PDF Viewer com o novo link&nbsp;                                                                                                                                                                                     
                =================================================================== */                                                                                                                                                                         
                function (oData) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    var sSource = vServiceURL + vServiceUrlRead;                                                                                                                                                                                               
                    var opdfViewer = new sap.m.PDFViewer();                                                                                                                                                                                                    
                    this.getView().addDependent(opdfViewer);                                                                                                                                                                                                   
                    opdfViewer.setSource(sSource);                                                                                                                                                                                                             
                    opdfViewer.setTitle("Visualizar");                                                                                                                                                                                                         
                    opdfViewer.open();                                                                                                                                                                                                                         
                }.bind(this),                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                function (error) {                                                                                                                                                                                                                             
                    alert('Falha ao buscar arquivo');                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
        }                                                                                                                                                                                                                                                      
    };                                                                                                                                                                                                                                                         
});                                                                                                                                                                                                                                                            